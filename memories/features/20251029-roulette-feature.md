# ルーレット機能

## 日付
2025-10-29

## 実装目的
ユーザーがランダムに選択を行うためのルーレット機能を提供する。抽選やくじ引き、決断をサポートするツールとして使用できる。

## 機能要件

### 当選対象の管理
- 任意の数の項目（当選対象）を追加・削除できる
- 各項目には以下を設定可能：
  - ラベル（テキスト）
  - 色（カラーコード）

### ルーレットの表示
- 当選対象を等分した扇形で円形に表示
- 各扇形は設定した色で塗りつぶす
- 各扇形の上に当選対象のラベルを表示
- 中央に当選位置を示すマーカー（矢印）を配置

### アニメーション・抽選機能
- 「開始」ボタンで回転開始
- ランダムに算出された時間（2〜5秒程度）回転
- イージング効果で徐々に減速
- 停止後、当選した項目を明確に表示

### 結果表示
- 当選した項目のラベルを大きく表示
- 再度抽選可能な「もう一度」ボタンを表示

## 画面構成・UI

### レイアウト構成
```
+----------------------------------+
|   ルーレット                      |
+----------------------------------+
|                                  |
|   [ルーレット円形表示エリア]      |
|   - 中央に矢印マーカー            |
|   - 回転する扇形の集合            |
|                                  |
+----------------------------------+
|   [当選結果表示エリア]            |
|   「◯◯ が当選！」                |
+----------------------------------+
|   [開始ボタン]                    |
+----------------------------------+
|                                  |
|   [項目追加・編集エリア]          |
|   - 項目リスト                    |
|   - 追加フォーム                  |
|                                  |
+----------------------------------+
```

### 項目編集UI
- 各項目：`[色] ラベル [削除ボタン]`
- 追加フォーム：`[ラベル入力] [色選択] [追加ボタン]`

## データ構造

### RouletteItem型
```typescript
interface RouletteItem {
  id: string
  label: string
  color: string // HEX color code
}
```

### State管理
```typescript
const [items, setItems] = useState<RouletteItem[]>([]) // 当選対象リスト
const [spinning, setSpinning] = useState(false) // 回転中フラグ
const [winner, setWinner] = useState<RouletteItem | null>(null) // 当選結果
const [rotation, setRotation] = useState(0) // 現在の回転角度
```

## 実装ファイル

### 新規作成
- `src/pages/OtherTools/Roulette.tsx` - メインコンポーネント
- `src/pages/OtherTools/Roulette.module.css` - スタイル
- `src/utils/rouletteUtils.ts` - ルーレット用ユーティリティ関数

### 修正
- `src/App.tsx` - ルーティング追加
- `src/pages/Home.tsx` - ルーレットへのリンク追加

## 技術的判断

### SVGを使用した描画
**判断**: Canvas APIではなくSVGで扇形を描画する

**理由**:
- Reactの宣言的な記述と相性が良い
- アクセシビリティが高い
- レスポンシブ対応が容易
- CSSアニメーションとの統合がスムーズ

### CSS Transformでの回転
**判断**: CSS `transform: rotate()` でルーレットを回転

**理由**:
- GPU加速により滑らかなアニメーション
- `transition` プロパティでイージング制御が簡単
- JavaScriptでの複雑なアニメーション制御が不要

### ランダム抽選ロジック
**判断**: 最終停止角度をランダムに決定し、そこから逆算して回転時間を調整

**理由**:
- 公平性が保証される
- 予測可能な動作
- デバッグしやすい

### デフォルト項目
**判断**: 初期状態で4つのサンプル項目を用意

**理由**:
- 初めてのユーザーがすぐに試せる
- 使い方が直感的に理解できる
- 空の状態を避けることでUXが向上

## リスク・注意点

### パフォーマンス
- 項目数が多い（20個以上）場合、SVG描画が重くなる可能性
  - 対策: 項目数の上限を設定（最大20個程度）

### アニメーション
- 回転中にブラウザタブを切り替えると、アニメーションが不正確になる可能性
  - 対策: `requestAnimationFrame` は使わず、CSS transitionを使用

### モバイル対応
- 小さい画面でルーレットが見づらくなる可能性
  - 対策: レスポンシブデザインでサイズ調整

### アクセシビリティ
- スクリーンリーダーで結果が読み上げられない可能性
  - 対策: `aria-live` 属性で結果を通知

## 完了条件

- [ ] ルーレットコンポーネントの実装
- [ ] 項目の追加・削除機能
- [ ] 項目の色とラベル設定
- [ ] ルーレットの回転アニメーション
- [ ] ランダム抽選ロジック
- [ ] 当選結果の表示
- [ ] レスポンシブデザイン
- [ ] ルーティングの追加
- [ ] ホームページへのリンク追加
- [ ] 型チェックとビルドの成功

## 将来的な拡張案

- 項目ごとの当選確率の重み付け
- 当選履歴の表示
- サウンドエフェクト
- カスタムテーマ（背景画像など）
- 項目のインポート/エクスポート機能
