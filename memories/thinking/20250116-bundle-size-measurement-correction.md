# バンドルサイズ測定の修正記録

## 日付
2025-01-16

## 状況
バンドルサイズ最適化の過程で、測定方法に誤りがあったことが判明しました。

## 不正確だった記録

### 当初の記録（誤り）
| タイミング | サイズ | 状況 |
|-----------|--------|------|
| React.lazy実装後 | 93-95 KB | ✅ 目標達成 |

### 問題点
- **初期ロードのメインバンドルのみを見ていた**
- ViewerMode.tsxのバンドル（104.64 KB）を見落としていた
- html5-qrcodeとPeerJSが含まれており、目標の100 KBを超えていた

## 正確な測定結果

### React.lazy実装直後（コミット b916505）
```
ViewerMode-Bt8sTe28.js: 104.64 KB (gzip) ← 最大バンドル
```
- **目標未達成**: ViewerModeが104.64 KBで目標超過
- 原因: html5-qrcodeとPeerJSがViewerModeに含まれていた

### 外部ライブラリ遅延ローディング後（最終）
```
index-BbiSuIWw.js:     98.57 KB (gzip) ← メインバンドル
ViewerMode-CnWjQoRf.js: 6.59 KB (gzip) ← html5-qrcode分離後
```
- **目標達成**: すべてのバンドルが100 KB以下

## 学んだこと

1. **すべてのバンドルを確認する**
   - メインバンドルだけでなく、すべての分割されたバンドルを確認する必要がある
   - 特に大きなライブラリを含むページコンポーネントに注意

2. **React.lazyだけでは不十分**
   - コンポーネントの遅延ローディングは有効
   - しかし、コンポーネント内で使用する大きなライブラリも遅延ローディングが必要

3. **正確な測定方法**
   ```bash
   npm run build | grep "gzip:"
   ```
   - すべての出力を確認
   - 最大バンドルサイズを記録
   - 目標超過していないか全バンドルをチェック

## 修正内容

- Plans.mdのバンドルサイズ推移表を正確な情報に更新
- 更新履歴に修正記録を追加
- 「React.lazy実装で目標達成」という誤った記録を訂正
- 「外部ライブラリ遅延ローディングで真の目標達成」と明記

## 今後の教訓

バンドルサイズ最適化では：
1. ビルド出力のすべてのファイルサイズを確認する
2. 最大バンドルサイズを記録する
3. 大きなライブラリの使用箇所を特定し、遅延ローディングを検討する
4. 測定結果は具体的なファイル名とサイズで記録する
