# decisions.md - 技術的意思決定の記録

このファイルは、プロジェクトの重要な技術的意思決定を一元管理します。

---

## 📋 意思決定記録の目的

- 過去の判断理由を明確に記録
- 将来の意思決定の参考にする
- チーム（または未来の自分）に判断根拠を伝える
- 同じ議論の繰り返しを防ぐ

---

## 🏗️ アーキテクチャ決定

### ADR-001: Tailwind CSS v4 + shadcn/ui の採用（2025-10-29）

**状況**:
- CSS Modules と shadcn/ui の併用でスタイル詳細度の問題が発生
- `!important` の多用は保守性を低下させる

**決定**:
- Tailwind CSS v4 に移行
- shadcn/ui を Tailwind ベースで使用
- CSS Modules は最小限に抑え、Tailwind クラスを直接追加

**理由**:
- shadcn/ui は `cn()` 関数と tailwind-merge でクラス競合を自動解決
- CSS cascade layers により詳細度の問題が発生しない
- バンドルサイズの削減（ゼロランタイム）

**影響**:
- CSS の記述方法が変更
- `!important` 禁止、インラインスタイル禁止
- Tailwind クラスを `className` prop に直接追加

**参照**:
- `memories/thinking/20251029-tailwind-css-modules-specificity.md`
- `memories/features/20251029-tailwind-shadcn-setup.md`

---

### ADR-002: 完全クライアントサイドアーキテクチャ（2025-10-28）

**状況**:
- バックエンドの構築・運用コストを避けたい
- ユーザーデータのプライバシーを保護したい

**決定**:
- すべての機能をクライアントサイドのみで実装
- サーバーサイド処理を必要としない設計
- LocalStorage でデータを永続化

**理由**:
- 軽量性とシンプルさの設計原則に合致
- ホスティングコストがゼロ（静的ホスティング）
- ユーザーデータがサーバーに保存されない（プライバシー）

**影響**:
- API や DB は使用しない
- カメラ映像共有は PeerJS（P2P）で実装
- オフライン対応が容易

**制約**:
- カメラ一覧化などの集約機能は不可能
- ユーザー間のデータ共有は限定的

**参照**:
- `CLAUDE.md` 87行目（設計原則）
- `memories/features/20251102-camera-sharing.md`

---

### ADR-003: PeerJS によるカメラ映像共有（2025-11-02）

**状況**:
- カメラ映像を他デバイスで見たい
- サーバーを使わずにリアルタイム通信を実現したい

**決定**:
- PeerJS を使用した P2P 通信
- ルームID ベースの接続
- 完全クライアントサイドで実装

**理由**:
- WebRTC をラップした使いやすい API
- サーバーレスでリアルタイム通信が可能
- バンドルサイズへの影響が小さい

**影響**:
- ルームID の手動入力が必要
- Peer 一覧の取得は不可能（PeerJS の制約）
- 共有リンク・QRコード機能で利便性を向上

**代替案を却下した理由**:
- WebSocket: サーバーが必要（設計原則違反）
- Socket.io: バンドルサイズが大きい
- 自前 WebRTC: 複雑すぎる

**参照**:
- `memories/features/20251102-camera-sharing.md`
- `memories/features/20251122-camera-sharing-enhancement.md`

---

## 🎨 デザイン決定

### DDR-001: ミニマルデザインの採用（2025-10-28）

**状況**:
- 多機能ツールサイトはUIが複雑になりがち
- シンプルで直感的なUIを提供したい

**決定**:
- 白黒ベース、装飾を排除
- 必要最小限の UI 要素のみ
- アクセシビリティを重視

**理由**:
- 軽量性の設計原則に合致
- ツールの使いやすさを向上
- バンドルサイズへの影響が小さい

**影響**:
- カラフルなアイコンやアニメーションは最小限
- フォーカスは機能性に集中
- Tailwind CSS でシンプルなスタイリング

**参照**:
- `CLAUDE.md` 86行目（設計原則）
- `docs/design-system.md`

---

## ⚡ パフォーマンス決定

### PDR-001: バンドルサイズ < 100KB の目標設定（2025-10-28）

**状況**:
- 初回ロード時間を 1 秒未満にしたい
- ユーザー体験を最優先

**決定**:
- バンドルサイズ（gzip）< 100KB を目標
- コード分割と遅延ローディングを積極的に使用
- 外部ライブラリは最小限

**理由**:
- モバイルユーザーの通信環境を考慮
- Core Web Vitals の改善
- Lighthouse Performance スコア 95+ を達成

**影響**:
- ライブラリ選定に慎重
- React.lazy() でページコンポーネントを分割
- 定期的なバンドルサイズのモニタリング

**現状**:
- 2025-01-16: 207.77 KB（目標未達、最適化が必要）

**参照**:
- `CLAUDE.md` 84行目（設計原則）
- `Plans.md`（バンドルサイズ最適化タスク）

---

## 🔧 ツール・ライブラリ決定

### TDR-001: React Router v6 の採用（2025-10-28）

**状況**:
- SPA でルーティングが必要

**決定**:
- React Router v6 を採用

**理由**:
- React の標準ルーティングライブラリ
- バンドルサイズが小さい
- コード分割との相性が良い

**代替案を却下した理由**:
- Tanstack Router: 新しすぎる、実績が少ない
- Wouter: 機能が不足

**参照**:
- `CLAUDE.md` 43行目（技術スタック）

---

### TDR-002: Vite の採用（2025-10-28）

**状況**:
- 高速なビルドツールが必要

**決定**:
- Vite を採用

**理由**:
- 最速の HMR（Hot Module Replacement）
- ビルド最適化が優れている
- TypeScript のサポートが標準

**代替案を却下した理由**:
- Create React App: ビルドが遅い、メンテナンスが停滞
- Webpack: 設定が複雑

**参照**:
- `CLAUDE.md` 40行目（技術スタック）

---

## 📝 更新履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-01-16 | decisions.md 初回作成、既存の主要な意思決定を記録 |

---

## 💡 決定記録のテンプレート

新しい意思決定を追加する際は、以下のテンプレートを使用してください：

```markdown
### [分類]-[番号]: [決定内容のタイトル]（YYYY-MM-DD）

**状況**:
[どんな問題や課題に直面したか]

**決定**:
[何を決定したか]

**理由**:
[なぜその決定をしたか]

**影響**:
[この決定がプロジェクトにどう影響するか]

**代替案を却下した理由**:（必要に応じて）
[検討したが採用しなかった選択肢とその理由]

**参照**:
- [関連ドキュメントへのリンク]
```

**分類**:
- ADR: Architecture Decision Record（アーキテクチャ決定）
- DDR: Design Decision Record（デザイン決定）
- PDR: Performance Decision Record（パフォーマンス決定）
- TDR: Tool Decision Record（ツール・ライブラリ決定）
