# Plans.md - タスク管理

このファイルは、プロジェクトのタスクと進捗を管理します。

---

## 🚀 現在の優先タスク

現在、優先タスクはありません。次のタスクは「バックログ」から選択してください。

---

## 📋 バックログ

### パフォーマンス最適化

- [ ] 画像最適化
  - [ ] public/ 内の画像を WebP 形式に変換
  - [ ] 画像の遅延ローディング
- [ ] CSS の最適化
  - [ ] 未使用 Tailwind クラスの削除

### PWA 改善

- [ ] オフラインキャッシュ戦略の最適化
- [ ] アプリアイコンの追加
- [ ] インストールプロンプトの実装

### アクセシビリティ

- [ ] すべてのページで ARIA ラベルを確認
- [ ] キーボードナビゲーションのテスト
- [ ] スクリーンリーダーのテスト
- [ ] カラーコントラスト比の確認

### テスト追加

- [ ] 主要コンポーネントのユニットテスト
- [ ] E2E テストの導入検討
- [ ] CI/CD パイプラインの構築

### 機能追加（検討中）

- [ ] ダークモード対応
- [ ] 多言語対応（英語）
- [ ] ツール使用統計のダッシュボード
- [ ] ツールのお気に入り機能

---

## ✅ 完了したタスク

### Phase 1: 基盤構築（完了）

- [x] プロジェクト設計
- [x] Vite + React セットアップ
- [x] ルーティング設定
- [x] 基本レイアウト作成
- [x] Tailwind CSS v4 + shadcn/ui セットアップ

### Phase 2: コアツール実装（完了）

- [x] カウントダウンタイマー
- [x] ストップウォッチ
- [x] 文字数カウンター
- [x] ポモドーロタイマー
- [x] テキスト差分
- [x] ランダム文字列生成
- [x] QRコード生成
- [x] パスワード生成
- [x] カラーピッカー
- [x] 現在日時表示（世界時計）
- [x] ルーレット

### Phase 3: 高度な機能（完了）

- [x] カメラ映像共有機能
- [x] PWA 対応
- [x] SEO 最適化
- [x] ツール使用状況トラッキング
- [x] キーボードショートカット
- [x] カメラ共有の共有機能強化（Phase 1）

### Phase 4: 最適化（完了）

- [x] バンドルサイズ最適化
  - [x] React.lazy() でページコンポーネントを遅延ローディング化
  - [x] App.tsx でルート定義を更新（React.lazy + Suspense）
  - [x] ビルドして効果を確認
  - [x] 目標達成（< 100KB）を確認
- [x] 外部ライブラリの遅延ローディング
  - [x] qrcode の遅延ローディング
    - [x] 使用箇所の特定（QRCodeGenerator.tsx、CameraMode.tsx）
    - [x] 動的 import() の実装
    - [x] エラーハンドリングの追加
  - [x] html5-qrcode の遅延ローディング
    - [x] 使用箇所の特定（QRScanner.tsx）
    - [x] 動的 import() の実装
    - [x] エラーハンドリングと型定義の追加
  - [x] PeerJS の遅延ローディング
    - [x] 使用箇所の特定（peerUtils.ts、usePeer.ts）
    - [x] createPeer() を非同期化し動的 import() を実装
    - [x] エラーハンドリングの追加
  - [x] ビルドして効果を確認
  - [x] バンドルサイズの改善を記録
  - [x] コミット

---

## 📝 ノート

### バンドルサイズの推移

| 日付 | 最大バンドル (gzip) | 詳細 | 目標達成 |
|------|-------------------|------|---------|
| 2025-01-16 (before) | 207.77 KB | index-BbiSuIWw.js: 207.77 KB | ❌ 目標超過 |
| 2025-01-16 (React.lazy) | 104.64 KB | ViewerMode-Bt8sTe28.js: 104.64 KB<br>（html5-qrcode + PeerJS 含む） | ❌ まだ目標超過 |
| 2025-01-16 (final) | **98.57 KB** | **index-BbiSuIWw.js: 98.57 KB**<br>ViewerMode-CnWjQoRf.js: 6.59 KB<br>（ライブラリ分離完了） | ✅ **目標達成** |

**目標**: 全バンドル < 100 KB (gzip)

**重要な発見**: React.lazy実装だけでは不十分で、ViewerModeに含まれていたhtml5-qrcodeとPeerJSが104.64 KBの原因でした。外部ライブラリの遅延ローディングによって初めて真の目標達成となりました。

### 技術的負債

1. ~~**バンドルサイズ超過**: 最優先で対応~~ ✅ 解決済み（2025-01-16）
2. **テスト不足**: E2E テストが未実装
3. **型定義の不完全性**: 一部で `any` が使用されている可能性

### 参考リンク

- [Vite - Code Splitting](https://vitejs.dev/guide/features.html#code-splitting)
- [React - Lazy Loading](https://react.dev/reference/react/lazy)
- [Web.dev - Bundle Size Optimization](https://web.dev/reduce-javascript-payloads-with-code-splitting/)

---

## 🔄 更新履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-01-16 | Plans.md 初回作成、バンドルサイズ最適化タスクを追加 |
| 2025-01-16 | React.lazy実装完了（207.77 KB → 最大104.64 KB）、まだ目標未達成 |
| 2025-01-16 | 外部ライブラリ遅延ローディング完了（qrcode、html5-qrcode、PeerJS）、最大バンドル98.57 KBで真の目標達成 ✅ |
| 2025-01-16 | バンドルサイズ推移表を正確な情報に修正（React.lazy実装後も104.64 KBで目標超過していた事実を記録） |
